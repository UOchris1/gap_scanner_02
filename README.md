# Gap Scanner 02

Single-entry gap scanner with one CLI, one pipeline, and an optional Streamlit UI. Clean, portable, and driven by `.env`.

- CLI: `scripts/gapctl.py`
- Shim: `src/integration/cli_bridge.py`
- Pipeline: `src/pipelines/zero_miss.py`
- Providers: `src/providers/*`
- Exports: `scripts/export_reports.py`

Important: do not commit secrets. `.env` is ignored. The auxiliary `chatgpt_package/` folder is not tracked.

## Prerequisites

- Python 3.10
- Git
- Optional: ThetaData Terminal (for R1 premarket signals)

## Setup (Windows PowerShell)

```powershell
git clone https://github.com/UOchris1/gap_scanner_02.git
cd gap_scanner_02
py -3.10 -m venv .venv
.\.venv\Scripts\Activate.ps1
python -m pip install --upgrade pip
pip install -r requirements.txt

copy .env.example .env   # edit with your keys (POLYGON_API_KEY required)
python -m scripts.gapctl env-format
python -m scripts.gapctl env-validate
python -m scripts.gapctl health
```

Linux/macOS is analogous (`python3.10 -m venv .venv` and `source .venv/bin/activate`).

## CLI Usage

```powershell
# Single day
python -m scripts.gapctl scan-day --date 2025-09-26 --db db/scanner.db

# Range
python -m scripts.gapctl scan-range --start 2025-09-22 --end 2025-09-26 --db db/scanner.db

# Exports
python -m scripts.gapctl export  --start 2025-09-22 --end 2025-09-26 --db db/scanner.db --out exports
python -m scripts.gapctl summary --start 2025-09-22 --end 2025-09-26 --db db/scanner.db --out exports
python -m scripts.gapctl outcomes --start 2025-09-22 --end 2025-09-26 --db db/scanner.db --out exports

# Acceptance (Theta optional)
python -m scripts.gapctl validate --date 2025-09-26 --db db/acceptance.db
```

Artifacts you should see:

- `db/scanner.db`
- `exports/discovery_hits_<start>_<end>.csv`
- `exports/day_completeness.csv`
- `exports/summary_<start>_<end>.csv`
- `exports/next_day_outcomes_<start>_<end>.csv`

## Streamlit UI

Launch with either command:

```powershell
streamlit run app/scan_ui.py
# or, on Windows, the helper batch file:
./run_streamlit.bat
```

UI tips:

- Single day, Multiple days, or Date range modes.
- Multiple days: pick a date then click “Add date” to accumulate; optional paste box accepts comma/newline ISO dates.
- Export folder: type a path or click “Select folder” to open the inline browser; click “Use this” to set. “Open folder” launches File Explorer.

## Environment (.env)

Required:

- `POLYGON_API_KEY`

Optional:

- `FMP_API_KEY`
- `THETA_V3_URL` / `THETA_V1_URL` (defaults to local terminal)
- `THETA_MAX_472_LOGS` (int, default `3`) — caps repeated Theta “472: No data found” logs per venue/day; set `0` to silence or `-1` to log all.

See `.env.example` for a template.

## Troubleshooting

- “API key not found”: ensure `.env` exists and contains `POLYGON_API_KEY`.
- ThetaData not detected: verify the local terminal is running; the pipeline still proceeds without R1.
- Streamlit folder picker: if OS dialogs are blocked, use the inline browser in the sidebar.
- Database locked: close apps holding `db/*.db`.

## Security

- Never commit `.env` or real keys.
- This repo ignores `chatgpt_package/` and other local artifacts via `.gitignore`.

## License / Support

For educational and research use. See source for inline docs. Use the issue tracker for bug reports.

## Feature Branch: Plotly Dash Charts

Branch name: `feature/plotly-dash-app`

Purpose: build a Plotly Dash application to visualize discoveries, outcomes, and related time‑series generated by the gap scanner (CSV exports and DB views).

Check out the branch:

```powershell
git fetch
git checkout feature/plotly-dash-app
```

Notes:

- Core CLI + pipeline remain on `main` (tag `v0.1.0` is a stable point).
- Dash app work will live under `dash/` with a launcher script once implemented.

